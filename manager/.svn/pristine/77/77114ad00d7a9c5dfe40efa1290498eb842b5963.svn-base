{"remainingRequest":"E:\\qingyunjiudian\\manager\\node_modules\\babel-loader\\lib\\index.js!E:\\qingyunjiudian\\manager\\node_modules\\eslint-loader\\index.js??ref--13-0!E:\\qingyunjiudian\\manager\\src\\role.js","dependencies":[{"path":"E:\\qingyunjiudian\\manager\\src\\role.js","mtime":1553328249054},{"path":"E:\\qingyunjiudian\\manager\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1558690126701},{"path":"E:\\qingyunjiudian\\manager\\node_modules\\babel-loader\\lib\\index.js","mtime":1529635966000},{"path":"E:\\qingyunjiudian\\manager\\node_modules\\eslint-loader\\index.js","mtime":1519638534000}],"contextDependencies":[],"result":["import _objectSpread from \"E:\\\\qingyunjiudian\\\\manager\\\\node_modules\\\\@babel\\\\runtime/helpers/builtin/es6/objectSpread\";\nimport router from \"./router/index\";\nimport store from \"./store/index\";\nimport NProgress from \"nprogress\"; // Progress 进度条\n\nimport \"nprogress/nprogress.css\"; // Progress 进度条样式\n\nimport { getAdminId } from \"./utils/auth\"; // 验权\n\nimport { Message } from \"element-ui\";\nimport { asyncRouterMap } from \"./router/index\"; // permissiom judge\n\nfunction hasRole(authRules, permissionAuthRules) {\n  if (!authRules || authRules.length <= 0) {\n    return false;\n  }\n\n  if (authRules.indexOf(\"admin\") >= 0) return true; // admin权限 直接通过\n\n  if (!permissionAuthRules) return true;\n  return authRules.some(function (role) {\n    return permissionAuthRules.indexOf(role) >= 0;\n  });\n}\n/**\r\n * 通过meta.role判断是否与当前用户权限匹配\r\n * @param authRules\r\n * @param route\r\n */\n\n\nfunction hasRouterRole(authRules, route) {\n  if (authRules.indexOf(\"admin\") >= 0 || !route.meta || !route.meta.authRule) {\n    return true;\n  }\n\n  return authRules.some(function (authRule) {\n    return route.meta.authRule.indexOf(authRule) >= 0;\n  });\n}\n/**\r\n * 递归过滤异步路由表，返回符合用户角色权限的路由表\r\n * @param asyncRouterMap\r\n * @param authRules\r\n */\n\n\nfunction filterAsyncRouter(asyncRouterMap, authRules) {\n  var accessedRouters = asyncRouterMap.filter(function (route) {\n    if (hasRouterRole(authRules, route)) {\n      if (route.children && route.children.length) {\n        route.children = filterAsyncRouter(route.children, authRules);\n      }\n\n      return true;\n    }\n\n    return false;\n  });\n  return accessedRouters;\n} // register global progress.\n\n\nvar whiteList = [\"/login\", \"/401\", \"/404\", \"/500\"]; // 不重定向白名单\n\nrouter.beforeEach(function (to, from, next) {\n  NProgress.configure({\n    ease: \"ease\",\n    speed: 800\n  });\n  NProgress.start(); // 开启Progress\n\n  if (whiteList.indexOf(to.path) !== -1) {\n    // 在免登录白名单，直接进入\n    next();\n    return;\n  }\n\n  var adminId = getAdminId();\n\n  if (adminId !== \"undefined\" && adminId !== \"\" && adminId) {\n    // 判断是否有token\n    if (to.path === \"/login\") {\n      next({\n        path: \"/\"\n      });\n      NProgress.done(); // router在hash模式下 手动改变hash 重定向回来 不会触发afterEach 暂时hack方案 ps：history模式下无问题，可删除该行！\n\n      return;\n    }\n\n    if (!store.getters.userName && (!store.getters.authRules || store.getters.authRules.length === 0)) {\n      // 判断当前用户是否已拉取完用户信息\n      store.dispatch(\"userInfo\").then(function (data) {\n        // 拉取user_info\n        var authRules = data.authRules || [];\n\n        if (!(authRules instanceof Array) || authRules.length === 0) {\n          Message.error(\"权限验证失败，请联系管理员~\");\n          next({\n            path: \"/401\",\n            query: {\n              noGoBack: true\n            }\n          });\n          NProgress.done();\n          return;\n        }\n\n        var accessedRouters = filterAsyncRouter(asyncRouterMap, authRules); // 生成可访问的路由表\n\n        router.addRoutes(accessedRouters); // 动态添加可访问路由表\n\n        next(_objectSpread({}, to)); // hack方法 确保addRoutes已完成\n        // 设置左边导航栏\n\n        store.dispatch(\"filterRouter\", {\n          accessedRouters: accessedRouters\n        }).then(function () {});\n      }).catch(function () {\n        store.dispatch(\"fedLogout\").then(function () {\n          Message.error(\"验证失败,请重新登录\"); // let redirect = to.fullPath;\n\n          store.dispatch(\"loginOut\").then(function () {\n            next({\n              path: \"/login\" // query: { redirect: redirect }\n\n            });\n          });\n        });\n      });\n      return;\n    } // 没有动态改变权限的需求可直接next() 删除下方权限判断 ↓\n\n\n    if (hasRole(store.getters.authRules, to.meta.authRule)) {\n      next(); //\n\n      return;\n    }\n\n    next({\n      path: \"/401\" // query: { noGoBack: true }\n\n    });\n    NProgress.done(); // router在hash模式下 手动改变hash 重定向回来 不会触发afterEach 暂时hack方案 ps：history模式下无问题，可删除该行！\n\n    return;\n  } // 退出登录 页面重定向错误路径处理(自带?redirect=**)\n  // let redirect = to.fullPath;\n\n\n  store.dispatch(\"loginOut\").then(function () {\n    next({\n      path: \"/login\" //query: { redirect: redirect }\n\n    });\n  }); // 否则全部重定向到登录页\n\n  NProgress.done(); // router在hash模式下 手动改变hash 重定向回来 不会触发afterEach 暂时hack方案 ps：history模式下无问题，可删除该行！\n});\nrouter.afterEach(function () {\n  NProgress.done(); // 结束Progress\n});",{"version":3,"sources":["src\\role.js"],"names":["router","store","NProgress","getAdminId","Message","asyncRouterMap","hasRole","authRules","permissionAuthRules","length","indexOf","some","role","hasRouterRole","route","meta","authRule","filterAsyncRouter","accessedRouters","filter","children","whiteList","beforeEach","to","from","next","configure","ease","speed","start","path","adminId","done","getters","userName","dispatch","then","data","Array","error","query","noGoBack","addRoutes","catch","afterEach"],"mappings":"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","sourceRoot":"E:\\qingyunjiudian\\manager","sourcesContent":["import router from \"./router/index\";\r\nimport store from \"./store/index\";\r\nimport NProgress from \"nprogress\"; // Progress 进度条\r\nimport \"nprogress/nprogress.css\"; // Progress 进度条样式\r\nimport { getAdminId } from \"./utils/auth\"; // 验权\r\nimport { Message } from \"element-ui\";\r\nimport { asyncRouterMap } from \"./router/index\";\r\n// permissiom judge\r\nfunction hasRole(authRules, permissionAuthRules) {\r\n    if (!authRules || authRules.length <= 0) {\r\n        return false;\r\n    }\r\n    if (authRules.indexOf(\"admin\") >= 0) return true; // admin权限 直接通过\r\n    if (!permissionAuthRules) return true;\r\n    return authRules.some(role => permissionAuthRules.indexOf(role) >= 0);\r\n}\r\n\r\n/**\r\n * 通过meta.role判断是否与当前用户权限匹配\r\n * @param authRules\r\n * @param route\r\n */\r\nfunction hasRouterRole(authRules, route) {\r\n    if (\r\n        authRules.indexOf(\"admin\") >= 0 ||\r\n        !route.meta ||\r\n        !route.meta.authRule\r\n    ) {\r\n        return true;\r\n    }\r\n    return authRules.some(\r\n        authRule => route.meta.authRule.indexOf(authRule) >= 0\r\n    );\r\n}\r\n\r\n/**\r\n * 递归过滤异步路由表，返回符合用户角色权限的路由表\r\n * @param asyncRouterMap\r\n * @param authRules\r\n */\r\nfunction filterAsyncRouter(asyncRouterMap, authRules) {\r\n    const accessedRouters = asyncRouterMap.filter(route => {\r\n        if (hasRouterRole(authRules, route)) {\r\n            if (route.children && route.children.length) {\r\n                route.children = filterAsyncRouter(route.children, authRules);\r\n            }\r\n            return true;\r\n        }\r\n        return false;\r\n    });\r\n    return accessedRouters;\r\n}\r\n\r\n// register global progress.\r\nconst whiteList = [\"/login\", \"/401\", \"/404\", \"/500\"]; // 不重定向白名单\r\nrouter.beforeEach((to, from, next) => {\r\n    NProgress.configure({ ease: \"ease\", speed: 800 });\r\n    NProgress.start(); // 开启Progress\r\n    if (whiteList.indexOf(to.path) !== -1) {\r\n        // 在免登录白名单，直接进入\r\n        next();\r\n        return;\r\n    }\r\n    let adminId = getAdminId();\r\n    if (adminId !== \"undefined\" && adminId !== \"\" && adminId) {\r\n        // 判断是否有token\r\n        if (to.path === \"/login\") {\r\n            next({ path: \"/\" });\r\n            NProgress.done(); // router在hash模式下 手动改变hash 重定向回来 不会触发afterEach 暂时hack方案 ps：history模式下无问题，可删除该行！\r\n            return;\r\n        }\r\n        if (\r\n            !store.getters.userName &&\r\n            (!store.getters.authRules || store.getters.authRules.length === 0)\r\n        ) {\r\n            // 判断当前用户是否已拉取完用户信息\r\n            store\r\n                .dispatch(\"userInfo\")\r\n                .then(data => {\r\n                    // 拉取user_info\r\n                    const authRules = data.authRules || [];\r\n                    if (\r\n                        !(authRules instanceof Array) ||\r\n                        authRules.length === 0\r\n                    ) {\r\n                        Message.error(\"权限验证失败，请联系管理员~\");\r\n                        next({\r\n                            path: \"/401\",\r\n                            query: { noGoBack: true }\r\n                        });\r\n                        NProgress.done();\r\n                        return;\r\n                    }\r\n                    let accessedRouters = filterAsyncRouter(\r\n                        asyncRouterMap,\r\n                        authRules\r\n                    );\r\n                    // 生成可访问的路由表\r\n                    router.addRoutes(accessedRouters); // 动态添加可访问路由表\r\n                    next({ ...to }); // hack方法 确保addRoutes已完成\r\n                    // 设置左边导航栏\r\n                    store\r\n                        .dispatch(\"filterRouter\", { accessedRouters })\r\n                        .then(() => {});\r\n                })\r\n                .catch(() => {\r\n                    store.dispatch(\"fedLogout\").then(() => {\r\n                        Message.error(\"验证失败,请重新登录\");\r\n                        // let redirect = to.fullPath;\r\n                        store.dispatch(\"loginOut\").then(() => {\r\n                            next({\r\n                                path: \"/login\"\r\n                                // query: { redirect: redirect }\r\n                            });\r\n                        });\r\n                    });\r\n                });\r\n            return;\r\n        }\r\n        // 没有动态改变权限的需求可直接next() 删除下方权限判断 ↓\r\n        if (hasRole(store.getters.authRules, to.meta.authRule)) {\r\n            next(); //\r\n            return;\r\n        }\r\n        next({\r\n            path: \"/401\"\r\n            // query: { noGoBack: true }\r\n        });\r\n        NProgress.done(); // router在hash模式下 手动改变hash 重定向回来 不会触发afterEach 暂时hack方案 ps：history模式下无问题，可删除该行！\r\n        return;\r\n    }\r\n    // 退出登录 页面重定向错误路径处理(自带?redirect=**)\r\n    // let redirect = to.fullPath;\r\n    store.dispatch(\"loginOut\").then(() => {\r\n        next({\r\n            path: \"/login\"\r\n            //query: { redirect: redirect }\r\n        });\r\n    }); // 否则全部重定向到登录页\r\n    NProgress.done(); // router在hash模式下 手动改变hash 重定向回来 不会触发afterEach 暂时hack方案 ps：history模式下无问题，可删除该行！\r\n});\r\n\r\nrouter.afterEach(() => {\r\n    NProgress.done(); // 结束Progress\r\n});\r\n"]}]}